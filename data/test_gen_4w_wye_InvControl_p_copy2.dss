! This case is designed to test a 3-phase, wye-connected generator

Clear

New Circuit.Test phases=3 basekv=0.4 baseMVA=1 bus1=B1 MVASC1=1e6 MVASC3=1e6

// New Linecode.Zabcn units=km nphases=4
// ~ rmatrix=(0.227217624 0 0 0 |0 0.227217624 0 0 |0 0 0.227217624 0 |0 0 0 0.227217624)
// ~ xmatrix=(0.879326005 0 0 0 |0 0.879326005 0 0 |0 0 0.879326005 0 |0 0 0 0.879326005)
// ~ cmatrix=(0 | 0 0 | 0 0 0 | 0 0 0 0)
// ~ Rg = 0
// ~ Xg = 0

// New Line.Line1 bus1=B1.1.2.3.0 bus2=B2.1.2.3.4 linecode=Zabcn length=1 units=km
// New Reactor.grounding  bus1=B2.4  bus2=B2.0  r=0  x=0.0001

! creates unbalance at B2:
! vm_b2 = [0.964, 1.01, 1.00, 0.05] without other devices active
New Load.Load1  phases=1 bus1=B1.1.0  kv=0.2309  model=1 conn=wye kVA=10 pf=0.9 vminpu=0.1 vmaxpu=2
New Load.Load2  phases=1 bus1=B1.2.0  kv=0.2309  model=1 conn=wye kVA=5  pf=0.9 vminpu=0.1 vmaxpu=2

! this will be converted to a generator in the data model transformation
! do not change to anything besides PF=1.0; weird OpenDSS behavior
New PVSystem.PV1 phases=1 conn=wye bus1=B1.1.0 kv=0.2309 kva=13.33 pf=1.0 irradiance=1 Pmpp=11.66 %R=0 %X=0 model=1
// New PVSystem.PV2 phases=1 conn=wye bus1=B2.2.4 kv=0.23 kva=13.33 pf=1.0 irradiance=1 Pmpp=11.66 %R=0 %X=0 model=1
// New PVSystem.PV3 phases=1 conn=wye bus1=B2.3.4 kv=0.23 kva=13.33 pf=1.0 irradiance=1 Pmpp=11.66 %R=0 %X=0 model=1

New XYCurve.vv_curve npts=4 Yarray=(1.0,1.0,-1.0,-1.0) XArray=(0.5,0.95,1.05,1.5)
New InvControl.InvPVCtrl mode=VOLTVAR voltage_curvex_ref=rated vvc_curve1=vv_curve EventLog=yes //VarChangeTolerance=0.01 VoltageChangeTolerance=0.001

Set tolerance = 0.00000001
Set voltagebases=[0.4]
Calcvoltagebases

Solve
